<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/events"></ion-back-button>
    </ion-buttons>
    <ion-title>Detail Event</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div *ngIf="isLoading" class="ion-padding">
    <ion-skeleton-text animated style="width: 100%; height: 200px;"></ion-skeleton-text>
    <ion-skeleton-text animated style="width: 60%; margin-top: 16px;"></ion-skeleton-text>
    <ion-skeleton-text animated style="width: 80%;"></ion-skeleton-text>
  </div>

  <div *ngIf="!isLoading && event" class="event-detail-container">
    <!-- Event Header Image -->
    <div class="event-header">
      <img [src]="environment.baseUrl + '/' + event.image_path" 
           [alt]="event.title"
           class="event-image"
           onError="this.src='assets/default-event.jpg'">
      <div class="event-header-content">
        <h1>{{ event.title }}</h1>
        <p class="event-organizer">Diselenggarakan oleh {{ event.admin?.name }}</p>
      </div>
    </div>

    <!-- Quick Info Cards -->
    <div class="quick-info-grid">
      <ion-card class="quick-info-card">
        <ion-card-content>
          <ion-icon name="calendar-outline" color="primary"></ion-icon>
          <div class="info-text">
            <small>Tanggal Mulai</small>
            <strong>{{ formatDate(event.start_datetime) }}</strong>
          </div>
        </ion-card-content>
      </ion-card>

      <ion-card class="quick-info-card">
        <ion-card-content>
          <ion-icon name="location-outline" color="primary"></ion-icon>
          <div class="info-text">
            <small>Lokasi</small>
            <strong>{{ event.location }}</strong>
          </div>
        </ion-card-content>
      </ion-card>

      <ion-card class="quick-info-card">
        <ion-card-content>
          <ion-icon name="cash-outline" color="primary"></ion-icon>
          <div class="info-text">
            <small>Biaya</small>
            <strong>Rp {{ formatPrice(event.price) | number:'1.0-0' }}</strong>
          </div>
        </ion-card-content>
      </ion-card>

      <ion-card class="quick-info-card">
        <ion-card-content>
          <ion-icon name="people-outline" color="primary"></ion-icon>
          <div class="info-text">
            <small>Kuota</small>
            <strong>{{ event.max_participants }} peserta</strong>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Event Description -->
    <ion-card class="description-card">
      <ion-card-header>
        <ion-card-title>Deskripsi Event</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <p class="description-text">{{ event.description }}</p>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Fixed bottom toolbar for registration -->
  <ion-footer *ngIf="!isLoading && event && !isAdmin">
    <ion-toolbar>
      <div class="registration-toolbar">
        <div class="registration-info">
          <ion-text color="medium">Status:</ion-text>
          <ion-badge [color]="participant?.attendance_status === 'present' ? 'success' : (isRegistered ? 'primary' : 'medium')">
            {{ participant?.attendance_status === 'present' ? 'Hadir' : (isRegistered ? 'Terdaftar' : 'Belum Terdaftar') }}
          </ion-badge>
        </div>
        <ion-button *ngIf="participant?.attendance_status === 'present'" (click)="downloadCertificate()" expand="block" color="success">
          Download Sertifikat
        </ion-button>
        <ion-button *ngIf="isRegistered && participant?.attendance_status !== 'present'" color="danger" expand="block" (click)="batalkanPendaftaran()">
          Batalkan Daftar
        </ion-button>
        <ion-button *ngIf="!isRegistered && (!participant || participant?.attendance_status !== 'present')" (click)="showRegistrationForm()" expand="block">
          Daftar Sekarang
        </ion-button>
      </div>
    </ion-toolbar>
  </ion-footer>
</ion-content> 